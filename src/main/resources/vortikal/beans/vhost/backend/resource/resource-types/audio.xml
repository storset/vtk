<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
	
	<import resource="file.xml" />

    <!-- Audio resource -->
	<bean id="audioResourceTypeDefinition"
		class="org.vortikal.repository.resourcetype.PrimaryResourceTypeDefinitionImpl">
		<property name="name" value="audio" />
		<property name="namespace" ref="AUDIO_NAMESPACE" />
		<property name="parentTypeDefinition" ref="fileResourceTypeDefinition" />
		<property name="assertions" ref="contentTypeMatchesAudio" />
		<property name="propertyTypeDefinitions">
			<list>
				<ref bean="audioTitlePropDef" />
				<ref bean="audioAuthorPropDef" />
				<ref bean="audioAlbumPropDef" />
				<ref bean="audioTrackPropDef" />
				<ref bean="audioGenrePropDef" />
				<ref bean="audioOverriddenTitlePropDef" />
			</list>
		</property>
	</bean>
	
	<bean id="contentTypeMatchesAudio"
		class="org.vortikal.web.service.ResourceContentTypeRegexpAssertion">
		<property name="pattern" value="audio/(.+)" />
	</bean>
	
	<bean id="audioAuthorPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="author" />
		<property name="contentModificationEvaluator" ref="audioAuthorPropertyEvaluator" />
	</bean>
	
	<bean id="audioAuthorPropertyEvaluator"
		class="org.vortikal.repository.resourcetype.property.AudioFilePropertyEvaluator">
		<property name="audioFileProperty"
			value="${resourcetype.audio.audiofileProperty.author}" />
	</bean>
	
	<bean id="audioAlbumPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="album" />
		<property name="contentModificationEvaluator" ref="audioAlbumPropertyEvaluator" />
	</bean>
	
	<bean id="audioAlbumPropertyEvaluator"
		class="org.vortikal.repository.resourcetype.property.AudioFilePropertyEvaluator">
		<property name="audioFileProperty"
			value="${resourcetype.audio.audiofileProperty.album}" />
	</bean>
	
	<bean id="audioTitlePropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="title" />
		<property name="contentModificationEvaluator" ref="audioTitlePropertyEvaluator" />
	</bean>
	
	<bean id="audioTitlePropertyEvaluator"
		class="org.vortikal.repository.resourcetype.property.AudioFilePropertyEvaluator">
		<property name="audioFileProperty"
			value="${resourcetype.audio.audiofileProperty.title}" />
	</bean>
	
	<bean id="audioOverriddenTitlePropDef"
		class="org.vortikal.repository.resourcetype.OverridingPropertyTypeDefinitionImpl">
		<property name="overriddenPropDef" ref="titlePropDef" />
		<property name="contentModificationEvaluator" ref="audioOverriddenTitlePropertyEvaluator" />
		<property name="nameModificationEvaluator" ref="audioOverriddenTitlePropertyEvaluator" />
	</bean>
	
	<bean id="audioOverriddenTitlePropertyEvaluator" parent="titleEvaluator">
		<property name="fallbackTitlePropDef" ref="audioTitlePropDef" />
	</bean>
	
	<bean id="audioTrackPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="track" />
		<property name="contentModificationEvaluator" ref="audioTrackPropertyEvaluator" />
	</bean>
	
	<bean id="audioTrackPropertyEvaluator"
		class="org.vortikal.repository.resourcetype.property.AudioFilePropertyEvaluator">
		<property name="audioFileProperty"
			value="${resourcetype.audio.audiofileProperty.track}" />
	</bean>
	
	<bean id="audioGenrePropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="genre" />
		<property name="contentModificationEvaluator" ref="audioGenrePropertyEvaluator" />
	</bean>
	
	<bean id="audioGenrePropertyEvaluator"
		class="org.vortikal.repository.resourcetype.property.AudioFilePropertyEvaluator">
		<property name="audioFileProperty"
			value="${resourcetype.audio.audiofileProperty.genre}" />
	</bean>
	
	<bean id="AUDIO_NAMESPACE" class="org.vortikal.repository.Namespace">
		<constructor-arg value="audio" />
		<constructor-arg value="audio" />
	</bean>
	
</beans>