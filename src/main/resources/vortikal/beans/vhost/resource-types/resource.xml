<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

  <!-- Resource - base resource type -->

  <bean id="resourceResourceTypeDefinition" class="org.vortikal.repository.resourcetype.PrimaryResourceTypeDefinitionImpl">
    <property name="name" value="resource"/>
    <property name="namespace" ref="DEFAULT_NAMESPACE" />
    <property name="mixinTypeDefinitions">
      <list>
        <ref bean="contentDescriptionMixinResourceTypeDef" />
        <ref bean="headerControlMixinResourceTypeDef" />
        <ref bean="scientificDisciplinesMixinResourceTypeDef" />
      </list>
    </property>    
    <property name="propertyTypeDefinitions">
      <list>
        <ref bean="ownerPropDef" />
        <ref bean="createdByPropDef" />
        <ref bean="collectionPropDef" />
        <ref bean="creationTimePropDef" />
        <ref bean="contentLastModifiedPropDef" />
        <ref bean="contentModifiedByPropDef" />
        <ref bean="propertiesLastModifiedPropDef" />
        <ref bean="propertiesModifiedByPropDef" />
        <ref bean="lastModifiedPropDef" />
        <ref bean="modifiedByPropDef" />
        <ref bean="userTitlePropDef" />
        <ref bean="titlePropDef" />
        <ref bean="contentLocalePropDef" />
        <ref bean="numberOfCommentsPropDef" />
      </list>
    </property>
  </bean>
  
  <bean id="numberOfCommentsPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
        parent="abstractPropDef">
    <property name="name" value="numberOfComments"/>
    <property name="type" value="INT"/>
    <property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE"/>
    <property name="propertiesModificationEvaluator" ref="numberOfCommentsModifiedEvaluator" />
  </bean>
  
  <bean id="numberOfCommentsModifiedEvaluator" class="org.vortikal.repository.resourcetype.property.NumberOfCommentsModifiedEvaluator" />
  
  <bean id="titlePropDef" class="org.vortikal.repository.resourcetype.OverridablePropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="title" />
    <property name="type" value="HTML" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="titleEvaluator" />
    <property name="contentModificationEvaluator" ref="titleEvaluator" />
    <property name="nameModificationEvaluator" ref="titleEvaluator" />
  </bean>

  <bean id="titleEvaluator" class="org.vortikal.repository.resourcetype.property.DefaultTitleEvaluator">
    <property name="propertyDefinition" ref="userTitlePropDef" />
  </bean>

  <bean id="userTitlePropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="contentRelation" value="PRE_CONTENT" />
    <property name="name" value="userTitle"/>
    <property name="type" value="HTML"/>
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ACL_WRITE"/>
    <property name="mandatory" value="false"/>
    <property name="valueFormatter" ref="htmlFormatter" />
  </bean>

  <bean id="htmlUtil" class="org.vortikal.text.html.HtmlUtil">
    <property name="htmlParser" ref="decorating.htmlParser" />
    <property name="htmlEntityMap" ref="htmlEntityMap" />
    <property name="safeHtmlFilter" ref="safeHtml.filter" />
  </bean>

  <bean id="htmlFormatter" class="org.vortikal.repository.resourcetype.HtmlValueFormatter">
    <property name="htmlUtil" ref="htmlUtil" />
  </bean>

  <bean id="htmlEntityMap" class="org.springframework.beans.factory.config.MapFactoryBean">
    <property name="sourceMap">
      <map>
        <!-- TODO: complete this list -->

        <!-- ASCII entities -->
        <entry key="quot" value="&#34;" />
        <entry key="apos" value="&#39;" />
        <entry key="amp" value="&#38;" />
        <entry key="lt" value="&#60;" />
        <entry key="gt" value="&#62;" />
        
        <!-- Latin 1 entities -->
        <entry key="nbsp" value="&#160;" />
        <entry key="iexcl" value="¡" />
        <entry key="cent" value="¢" />
        <entry key="pound" value="£" />
        <entry key="curren" value="¤" />
        <entry key="yen" value="¥" />
        <entry key="brvbar" value="¦" />
        <entry key="sect" value="§" />
        <entry key="uml" value="¨" />
        <entry key="copy" value="©" />
        <entry key="ordf" value="ª" />
        <entry key="laquo" value="«" />
        <entry key="not" value="¬" />
        <entry key="shy" value="­" />
        <entry key="reg" value="®" />
        <entry key="macr" value="¯" />
        <entry key="deg" value="°" />
        <entry key="plusmn" value="±" />
        <entry key="sup2" value="²" />
        <entry key="sup3" value="³" />
        <entry key="acute" value="´" />
        <entry key="micro" value="µ" />
        <entry key="para" value="¶" />
        <entry key="middot" value="·" />
        <entry key="cedil" value="¸" />
        <entry key="sup1" value="¹" />
        <entry key="ordm" value="º" />
        <entry key="raquo" value="»" />
        <entry key="frac14" value="¼" />
        <entry key="frac12" value="½" />
        <entry key="frac34" value="¾" />
        <entry key="iquest" value="¿" />
        <entry key="Agrave" value="À" />
        <entry key="Aacute" value="Á" />
        <entry key="Acirc" value="Â" />
        <entry key="Atilde" value="Ã" />
        <entry key="Auml" value="Ä" />
        <entry key="Aring" value="Å" />
        <entry key="AElig" value="Æ" />
        <entry key="Ccedil" value="Ç" />
        <entry key="Egrave" value="È" />
        <entry key="Eacute" value="É" />
        <entry key="Ecirc" value="Ê" />
        <entry key="Euml" value="Ë" />
        <entry key="Igrave" value="Ì" />
        <entry key="Iacute" value="Í" />
        <entry key="Icirc" value="Î" />
        <entry key="Iuml" value="Ï" />
        <entry key="ETH" value="Ð" />
        <entry key="Ntilde" value="Ñ" />
        <entry key="Ograve" value="Ò" />
        <entry key="Oacute" value="Ó" />
        <entry key="Ocirc" value="Ô" />
        <entry key="Otilde" value="Õ" />
        <entry key="Ouml" value="Ö" />
        <entry key="times" value="×" />
        <entry key="Oslash" value="Ø" />
        <entry key="Ugrave" value="Ù" />
        <entry key="Uacute" value="Ú" />
        <entry key="Ucirc" value="Û" />
        <entry key="Uuml" value="Ü" />
        <entry key="Yacute" value="Ý" />
        <entry key="THORN" value="Þ" />
        <entry key="szlig" value="ß" />
        <entry key="agrave" value="à" />
        <entry key="aacute" value="á" />
        <entry key="acirc" value="â" />
        <entry key="atilde" value="ã" />
        <entry key="auml" value="ä" />
        <entry key="aring" value="å" />
        <entry key="aelig" value="æ" />
        <entry key="ccedil" value="ç" />
        <entry key="egrave" value="è" />
        <entry key="eacute" value="é" />
        <entry key="ecirc" value="ê" />
        <entry key="euml" value="ë" />
        <entry key="igrave" value="ì" />
        <entry key="iacute" value="í" />
        <entry key="icirc" value="î" />
        <entry key="iuml" value="ï" />
        <entry key="eth" value="ð" />
        <entry key="ntilde" value="ñ" />
        <entry key="ograve" value="ò" />
        <entry key="oacute" value="ó" />
        <entry key="ocirc" value="ô" />
        <entry key="otilde" value="õ" />
        <entry key="ouml" value="ö" />
        <entry key="divide" value="÷" />
        <entry key="oslash" value="ø" />
        <entry key="ugrave" value="ù" />
        <entry key="uacute" value="ú" />
        <entry key="ucirc" value="û" />
        <entry key="uuml" value="ü" />
        <entry key="yacute" value="ý" />
        <entry key="thorn" value="þ" />
        <entry key="yuml" value="ÿ" />
      </map>
    </property>
  </bean>


  <bean id="safeHtml.filter" class="org.vortikal.text.html.SimpleHtmlPageFilter">
    <property name="illegalElements" ref="safeHtml.illegalElementSet" />
    <property name="validElements" ref="safeHtml.validElementSet" />
  </bean>

  <bean id="safeHtml.illegalElementSet" class="org.springframework.beans.factory.config.SetFactoryBean">
    <property name="sourceSet">
      <set>
        <value>script</value>
        <value>style</value>
        <value>form</value>
        <value>input</value>
        <value>frameset</value>
        <value>frame</value>
        <value>iframe</value>
        <value>object</value>
        <value>embed</value>
        <value>meta</value>
        <value>link</value>
      </set>
    </property>
  </bean>

  <bean id="safeHtml.validElementSet" class="org.springframework.beans.factory.config.SetFactoryBean">
    <property name="sourceSet">
      <set>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="a" />
          <property name="attributes">
            <set>
              <value>href</value>
            </set>
          </property>
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="div" />
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="p" />
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="ul" />
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="li" />
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="ol" />
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="em" />
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="strong" />
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="cite" />
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="code" />
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="strike" />
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="u" />
        </bean>
        <bean class="org.vortikal.text.html.HtmlElementDescriptor">
          <property name="name" value="img" />
          <property name="validAsEmpty" value="true" />
          <property name="attributes">
            <set>
              <value>src</value>
              <value>alt</value>
            </set>
          </property>
        </bean>
      </set>
    </property>
  </bean>



  <bean id="createdByPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="createdBy" />
    <property name="type" value="PRINCIPAL" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="ownerEvaluator" />
  </bean>

  <bean id="ownerPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="owner" />
    <property name="type" value="PRINCIPAL" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ACL_ADMIN" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="ownerEvaluator" />
    <property name="validator" ref="ownerEvaluator" />
  </bean>

  <bean id="ownerEvaluator" class="org.vortikal.repository.resourcetype.property.OwnerEvaluator">
    <property name="principalManager" ref="principalManager" />
    <property name="authorizationManager" ref="authorizationManager" />
  </bean>
  
  <bean id="principalEvaluator" class="org.vortikal.repository.resourcetype.property.PrincipalEvaluator">
    <property name="principalManager" ref="principalManager" />
  </bean>

  <bean id="collectionPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="collection" />
    <property name="type" value="BOOLEAN" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="collectionEvaluator" /> 
  </bean>

  <bean id="collectionEvaluator" class="org.vortikal.repository.resourcetype.property.CollectionEvaluator" />


  <bean id="creationTimePropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="creationTime" />
    <property name="type" value="TIMESTAMP" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="creationTimeEvaluator" />
  </bean>

  <bean id="creationTimeEvaluator" 
        class="org.vortikal.repository.resourcetype.property.CreationTimeEvaluator" />


  <bean id="contentLastModifiedPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="contentLastModified" />
    <property name="type" value="TIMESTAMP" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="contentLastModifiedEvaluator" />
    <property name="contentModificationEvaluator" ref="contentLastModifiedEvaluator" />
  </bean>

  <bean id="contentLastModifiedEvaluator" class="org.vortikal.repository.resourcetype.property.ContentLastModifiedEvaluator" />
  

  <bean id="contentModifiedByPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="contentModifiedBy" />
    <property name="type" value="PRINCIPAL" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="contentModifiedByEvaluator" />
    <property name="contentModificationEvaluator" ref="contentModifiedByEvaluator" />
  </bean>

  <bean id="contentModifiedByEvaluator" class="org.vortikal.repository.resourcetype.property.ContentModifiedByEvaluator" />
  

  <bean id="propertiesLastModifiedPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="propertiesLastModified" />
    <property name="type" value="TIMESTAMP" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="propertiesLastModifiedEvaluator" />
    <property name="propertiesModificationEvaluator" ref="propertiesLastModifiedEvaluator" />
  </bean>

  <bean id="propertiesLastModifiedEvaluator" class="org.vortikal.repository.resourcetype.property.PropertiesLastModifiedEvaluator" />
  

  <bean id="propertiesModifiedByPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="propertiesModifiedBy" />
    <property name="type" value="PRINCIPAL" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="propertiesModifiedByEvaluator" />
    <property name="propertiesModificationEvaluator" ref="propertiesModifiedByEvaluator" />
  </bean>

  <bean id="propertiesModifiedByEvaluator" class="org.vortikal.repository.resourcetype.property.PropertiesModifiedByEvaluator" />
  

  <bean id="lastModifiedPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="lastModified" />
    <property name="type" value="TIMESTAMP" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="lastModifiedEvaluator" />
    <property name="propertiesModificationEvaluator" ref="lastModifiedEvaluator" />
    <property name="contentModificationEvaluator" ref="lastModifiedEvaluator" />
  </bean>

  <bean id="lastModifiedEvaluator" class="org.vortikal.repository.resourcetype.property.LastModifiedEvaluator" />


  <bean id="modifiedByPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="modifiedBy" />
    <property name="type" value="PRINCIPAL" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="lastModifiedByEvaluator" />
    <property name="contentModificationEvaluator" ref="lastModifiedByEvaluator" />
    <property name="propertiesModificationEvaluator" ref="lastModifiedByEvaluator" />
  </bean>

  <bean id="lastModifiedByEvaluator" class="org.vortikal.repository.resourcetype.property.LastModifiedByEvaluator" />

  <bean id="contentLocalePropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl" parent="abstractPropDef">
    <property name="name" value="contentLocale" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ACL_WRITE" />
    <property name="mandatory" value="false" />
    <!-- should have a constraint -->
    <property name="vocabulary">
      <bean class="org.vortikal.repository.resourcetype.ValueVocabulary">
        <property name="messageSourceBaseName" value="vortikal.beans.vhost.resource-types.content-locale" />
        <property name="values">
          <list>
            <bean class="org.vortikal.repository.resourcetype.Value">
              <constructor-arg type="java.lang.String">
                <value>no_NO</value>
              </constructor-arg>
            </bean>
            <bean class="org.vortikal.repository.resourcetype.Value">
              <constructor-arg type="java.lang.String">
                <value>no_NO_NY</value>
              </constructor-arg>
            </bean>
            <bean class="org.vortikal.repository.resourcetype.Value">
              <constructor-arg type="java.lang.String">
                <value>en</value>
              </constructor-arg>
            </bean>
          </list>
        </property>
      </bean>
    </property>
  </bean>

</beans>
