<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

   <bean id="decorating.componentsMessageSource"
         class="org.springframework.context.support.ResourceBundleMessageSource">
     <property name="basenames">
       <list>
         <value>vortikal.i18n.decorator-components</value>
       </list>
     </property>
   </bean>

  <bean id="decorating.documentNamespace" class="java.lang.String">
    <constructor-arg type="java.lang.String" value="document" />
  </bean>

  <bean id="decorating.resourceNamespace" class="java.lang.String">
    <constructor-arg type="java.lang.String" value="resource" />
  </bean>

  <bean id="decorating.includeNamespace" class="java.lang.String">
    <constructor-arg type="java.lang.String" value="include" />
  </bean>

  <bean id="decorating.cssNamespace" class="java.lang.String">
    <constructor-arg type="java.lang.String" value="css" />
  </bean>

  <!--
  <bean id="decorating.tocComponent"
        class="org.vortikal.web.decorating.components.HtmlTocComponent">
    <property name="namespace" ref="decorating.resourceNamespace" />
    <property name="name" value="toc" />
    <property name="description" value="Inserts a table of contents box" />
    <property name="view" ref="decorating.tocComponent.view" />
  </bean>

  <bean id="decorating.tocComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/page-toc.ftl" />
  </bean>
  -->

  <bean id="decorating.bodyComponent"
        class="org.vortikal.web.decorating.components.HtmlElementComponent">
    <property name="namespace" ref="decorating.documentNamespace" />
    <property name="name" value="body" />
    <property name="select" value="html.body" />
    <property name="enclosed" value="false" />
    <property name="exclude" value="" />
    <property name="description" value="Outputs the contents of the &lt;body&gt; tag of the original HTML document" />
  </bean>

  <bean id="decorating.headComponent"
        class="org.vortikal.web.decorating.components.HtmlElementComponent">
    <property name="namespace" ref="decorating.documentNamespace" />
    <property name="name" value="head" />
    <property name="select" value="html.head" />
    <property name="enclosed" value="false" />
    <property name="exclude" value="" />
    <property name="description" value="Outputs the contents of the &lt;head&gt; tag of the original HTML document" />
  </bean>

  <bean id="decorating.titleComponent"
        class="org.vortikal.web.decorating.components.HtmlElementComponent">
    <property name="namespace" ref="decorating.documentNamespace" />
    <property name="name" value="title" />
    <property name="select" value="html.head.title" />
    <property name="enclosed" value="false" />
    <property name="exclude" value="" />
    <property name="description" value="Outputs the contents of the &lt;title&gt; tag of the original HTML document" />
  </bean>

  <bean id="decorating.elementContentComponent"
        class="org.vortikal.web.decorating.components.HtmlElementComponent">
    <property name="namespace" ref="decorating.documentNamespace" />
    <property name="name" value="element" />
    <property name="description" value="Outputs the contents of a specified element" />
  </bean>

  <bean id="decorating.elementAttributesComponent"
        class="org.vortikal.web.decorating.components.HtmlAttributesComponent">
    <property name="namespace" ref="decorating.documentNamespace" />
    <property name="name" value="element-attributes" />
    <property name="description" value="Outputs the attributes of a specified element" />
  </bean>


  <bean id="decorating.manageURLComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.resourceNamespace" />
    <property name="name" value="manage-url" />
    <property name="description" value="Inserts the admin URL of the current document" />
    <property name="view" ref="decorating.manageURLComponent.view" />
    <property name="exposedParameters">
      <set>
        <value>display-only-if-auth</value>
      </set>
    </property>
    <property name="parameterDescriptions">
      <map>
        <entry key="display-only-if-auth"
               value="If set to 'true', do not display anything unless the user is logged in." />
      </map>
    </property>
  </bean>

  <bean id="decorating.manageURLComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/manage-link.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="decorating.manageURLComponent.urlProvider" />
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>

  <bean id="decorating.manageURLComponent.urlProvider"
        class="org.vortikal.web.referencedata.provider.ResourceServiceURLProvider"
        parent="requestLocalRepositoryAware">
    <property name="modelName" value="manageLink" />
    <property name="urlName" value="url" />
    <property name="service" ref="manageService" />
  </bean>

  <bean id="decorating.defaultCssComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.cssNamespace" />
    <property name="name" value="default" />
    <property name="description" value="Inserts a &lt;link rel=&quot;stylesheet&quot;...&gt; reference to the default CSS template" />
    <property name="view" ref="decorating.defaultCssComponent.view" />
  </bean>

  <bean id="decorating.defaultCssComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/css-ref.ftl" />
    <property name="attributes">
      <map>
        <entry key="url" value="${decorating.defaultCssComponent.defaultCss}" />
      </map>
    </property>
  </bean>

  <bean id="decorating.tableOfContentsComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" value="resource" />
    <property name="name" value="toc" />
    <property name="description" value="Inserts a table of contents based on h2/h3 in the document" />
    <property name="view" ref="decorating.tableOfContentsComponent.view" />
  </bean>

  <bean id="decorating.tableOfContentsComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/toc.ftl" />
    <property name="attributes">
      <map>
	   <entry key="url" value="${jsBaseURL}/toc.js" /> 
        <!-- entry key="url" value="${decorating.tableOfContentsComponent.javascript}" / -->
      </map>
    </property>
  </bean>
  
  <bean id="decorating.timeAndPlaceComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.resourceNamespace" />
    <property name="name" value="time-and-place" />
    <property name="description" value="Inserts time and place if it is an event document" />
    <property name="view" ref="decorating.timeAndPlaceComponent.view" />
  </bean>
  
  <bean id="decorating.timeAndPlaceComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/time-and-place.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>
  
    <bean id="decorating.mediaComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.resourceNamespace" />
    <property name="name" value="media-player" />
    <property name="description" value="Inserts media player if it is an article document" />
    <property name="view" ref="decorating.mediaComponent.view" />
  </bean>
  
  <bean id="decorating.mediaComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/media-player.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
        <bean class="org.vortikal.web.referencedata.provider.FixedResourceServiceURLProvider">
          <property name="repository" ref="repository" />
          <property name="uri" value="/" />
          <property name="appendPath" value="${flash.baseURL}/audioplayer.swf" />
          <property name="service" ref="viewService" />
          <property name="modelName" value="flashPlayer" />
          <property name="urlName" value="flashURL" />
        </bean>
        <bean class="org.vortikal.web.referencedata.provider.FixedResourceServiceURLProvider">
          <property name="repository" ref="repository" />
          <property name="uri" value="/" />
          <property name="appendPath" value="${jsBaseURL}/audio-player.js" />
          <property name="service" ref="viewService" />
          <property name="modelName" value="flashPlayer" />
          <property name="urlName" value="jsURL" />
        </bean>
      </list>
    </property>
  </bean>

 <bean id="decorating.resourceTagsComponent" parent="requestLocalRepositoryAware"
        class="org.vortikal.web.decorating.components.PropertyLinkedValueDecoratorComponent">
    <property name="namespace" ref="decorating.resourceNamespace" />
    <property name="name" value="tags" />
    <property name="propertyTypeDefinition" ref="tagsPropDef" />
    <property name="description" value="Inserts the resource keywords, linked to the tags view" />
    <property name="defaultURLpattern" value="${tagService.defaultExpression}" />
    <property name="view" ref="decorating.keywordsComponent.view" />
  </bean>

  <bean id="decorating.tagCloudComponent" 
        class="org.vortikal.web.decorating.components.TagCloudComponent">
    <property name="namespace" ref="decorating.includeNamespace" />
    <property name="name" value="tag-cloud" />
    <property name="view" ref="decorating.tagCloudComponent.view" />
    <property name="tagElementsProvider" ref="tags.tagElementsProvider" />
  </bean>

  <bean id="decorating.tagsComponent"
        class="org.vortikal.web.decorating.components.TagsComponent">
    <property name="namespace" ref="decorating.includeNamespace" />
    <property name="name" value="tags" />
    <property name="view" ref="decorating.tagsComponent.view" />
    <property name="tagElementsProvider" ref="tags.tagElementsProvider" />
  </bean>


  <bean id="decorating.resourcePropertyComponent" parent="requestLocalRepositoryAware"
        class="org.vortikal.web.decorating.components.ResourcePropertiesDecoratorComponent">
    <property name="namespace" ref="decorating.resourceNamespace" />
    <property name="name" value="property" />
    <property name="resourceTypeTree" ref="resourceTypeTree" />
  </bean>

  <bean id="decorating.includeResourcePropertyComponent" parent="requestLocalRepositoryAware"
        class="org.vortikal.web.decorating.components.ResourcePropertiesDecoratorComponent">
    <property name="namespace" ref="decorating.includeNamespace" />
    <property name="name" value="property" />
    <property name="relative" value="true" />
    <property name="resourceTypeTree" ref="resourceTypeTree" />
  </bean>

  <bean id="decorating.breadcrumbComponent" class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.resourceNamespace" />
    <property name="name" value="breadcrumb" />
    <property name="view" ref="decorating.breadcrumbComponent.view" />
    <property name="description" value="Inserts a breadcrumb trail to the current document" />
    <property name="exposedParameters">
      <set>
        <value>downcase</value>
        <value>include-last-element</value>
        <value>hide-prefix</value>
        <value>stop-at-level</value>
      </set>
    </property>
    <property name="parameterDescriptions">
      <map>
        <entry key="downcase"
               value="If set to 'true', display breadcrumb elements in lower-case. The default is 'false'." />
        <entry key="include-last-element"
               value="Whether to include the last element in the breadcrumb. The default is 'false'." />
        <entry key="hide-prefix"
               value="If set to 'true', the prefix 'You are here:' will be hidden. The default is 'false'." />
        <entry key="stop-at-level"
               value="This stops the breadcrumb generation at a certain number of levels. The default is none." />
      </map>               
    </property>
  </bean>


  <bean id="decorating.breadcrumbComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/breadcrumb.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="viewBreadCrumbProvider" />
      </list>
    </property>
  </bean>

  <bean id="decorating.keywordsComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/keywords.ftl" />
  </bean>

  <bean id="decorating.tagCloudComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/tag-cloud.ftl" />
  </bean>

 <bean id="decorating.tagsComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/tags.ftl" />
  </bean>


  <bean id="decorating.feedComponent"
        class="org.vortikal.web.decorating.components.FeedComponent">
    <property name="namespace" ref="decorating.includeNamespace" />
    <property name="name" value="feed" />
    <property name="view" ref="decorating.feedComponent.view" />
    <property name="description" value="Inserts a feed (RSS, Atom) component on the page" />
    <property name="contentCache" ref="decorating.feedComponent.contentCache" />
    <property name="localFeedFetcher" ref="decorating.feedComponent.localFeedFetcher" />
  </bean>

  <bean id="decorating.aggregatedFeedComponent"
        class="org.vortikal.web.decorating.components.AggregatedFeedsComponent">
    <property name="namespace" ref="decorating.includeNamespace" />
    <property name="name" value="feeds" />
    <property name="view" ref="decorating.feedComponent.view" />
    <property name="description" value="Inserts an aggregated feed (RSS, Atom) component on the page" />
    <property name="contentCache" ref="decorating.feedComponent.contentCache" />
    <property name="localFeedFetcher" ref="decorating.feedComponent.localFeedFetcher" />
  </bean>

  <bean id="decorating.feedComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/feed-listing.ftl" />
  </bean>

  <bean id="decorating.feedComponent.localFeedFetcher" class="org.vortikal.web.decorating.components.LocalFeedFetcher">
    <property name="feedBuilder" ref="decorating.feedComponent.feedBuilder" />
  </bean>

  <bean id="decorating.feedComponent.contentCache" class="org.vortikal.util.cache.ContentCache">
    <property name="name" value="${repositoryID}.decorating.feedCache" />
    <property name="cacheLoader" ref="decorating.feedComponent.contentCache.loader" />
    <property name="cacheSeconds" value="${decorating.feedComponent.cacheTimeoutSeconds}" />
    <property name="asynchronousRefresh" value="true" />
    <property name="refreshInterval" value="30" />
    <property name="maxItems" value="${decorating.feedComponent.maxCachedItems}" />
  </bean>

  <bean id="decorating.feedComponent.contentCache.loader"
        class="org.vortikal.web.decorating.components.SyndFeedLoader">
    <property name="connectTimeoutSeconds" value="${decorating.feedComponent.connectTimeoutSeconds}" />
    <property name="readTimeoutSeconds" value="${decorating.feedComponent.readTimeoutSeconds}" />
    <property name="clientIdentifier" value="${decorating.feedComponent.identifier}" />
    <property name="builder" ref="decorating.feedComponent.feedBuilder" />
  </bean>
  
  
  <bean id="decorating.feedComponent.feedBuilder" class="org.vortikal.web.decorating.components.SyndFeedBuilder">
    <property name="htmlParser" ref="decorating.htmlParser" />
    <property name="safeHtmlFilter" ref="safeHtml.filter" />
  </bean>

  <bean id="decorating.listMenuComponent"
        class="org.vortikal.web.decorating.components.ListMenuComponent">
    <property name="namespace" ref="decorating.includeNamespace" />
    <property name="name" value="uri-menu" />
    <property name="searcher" ref="systemIndexSearcher" />
    <!-- <property name="searchLimit" value="100" /> -->
    <property name="view" ref="decorating.listMenuComponent.view" />
    <property name="titlePropDef" ref="titlePropDef" />
    <property name="hiddenPropDef" ref="hiddenPropDef" />
    <property name="importancePropDef" ref="importancePropDef" />
    <property name="collectionResourceType" ref="collectionResourceTypeDefinition" />
    <property name="viewService" ref="webService" />
    <property name="navigationTitlePropDef" ref="navigationTitlePropDef" />
  </bean>
  
  <bean name="decorating.listMenuComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/list-menu.ftl" />
  </bean>
  
  <bean id="decorating.subFolderMenuComponent"
        class="org.vortikal.web.decorating.components.SubFolderMenuComponent">
    <property name="namespace" ref="decorating.resourceNamespace" />
    <property name="name" value="subfolder-menu" />
    <property name="searcher" ref="systemIndexSearcher" />
    <property name="searchLimit" value="1000" />
    <property name="view" ref="decorating.subFolderMenuComponent.view" />
    <property name="resourceTypeTree" ref="resourceTypeTree" />
    <property name="titlePropDef" ref="titlePropDef" />
    <property name="hiddenPropDef" ref="hiddenPropDef" />
    <property name="importancePropDef" ref="importancePropDef" />
    <property name="collectionResourceType" ref="collectionResourceTypeDefinition" />
    <property name="viewService" ref="webService" />
    <property name="modelName" value="subFolderMenu" />
    <property name="description" value="Lists the subfolders of the current folder" />
    <property name="navigationTitlePropDef" ref="navigationTitlePropDef" />
  </bean>

  <bean name="decorating.subFolderMenuComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/subfolder-menu.ftl" />
  </bean>


  <bean id="decorating.authenticationComponent"
        class="org.vortikal.web.decorating.components.AuthenticationComponent"
        parent="requestLocalRepositoryAware">
    <property name="namespace" ref="decorating.includeNamespace" />
    <property name="name" value="login" />
    <property name="view" ref="decorating.authenticationComponent.view" />
    <property name="loginService" ref="loginService" />
    <property name="logoutService" ref="logoutService" />
    <property name="description" value="Displays a login or logout URL" />
  </bean>

  <bean name="decorating.authenticationComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/login-logout.ftl" />
  </bean>


  <bean id="decorating.includeComponent"
        class="org.vortikal.web.decorating.components.IncludeComponent"
        parent="requestLocalRepositoryAware">
    <property name="namespace" ref="decorating.includeNamespace" />
    <property name="name" value="file" />
    <property name="description" value="Includes the contents of another document in the page" />
    <property name="httpIncludeCache" ref="decorating.includeComponent.httpIncludeCache" />
    <property name="htmlParser" ref="decorating.htmlParser" />
    <property name="uriPreProcessor" ref="uriPreProcessor" />
  </bean>

  <bean id="uriPreProcessor"
        class="org.vortikal.repository.search.preprocessor.QueryStringPreProcessorImpl">
    <property name="expressionEvaluators">
      <list>
        <bean class="org.vortikal.repository.search.preprocessor.CurrentFolderExpressionEvaluator"
              parent="requestLocalRepositoryAware" />
        <bean class="org.vortikal.repository.search.preprocessor.CurrentUriExpressionEvaluator" />
      </list>
    </property>
  </bean>

  <bean id="decorating.includeComponent.httpIncludeCache"
        class="org.vortikal.util.cache.ContentCache">
    <property name="name" value="${repositoryID}.decorating.includeCache" />
    <property name="cacheLoader" ref="decorating.includeComponent.httpIncludeCache.loader" />
    <property name="cacheSeconds" value="${decorating.includeComponent.cacheTimeoutSeconds}" />
    <property name="asynchronousRefresh" value="false" />
    <property name="refreshInterval" value="30" />
    <property name="maxItems" value="${decorating.includeComponent.maxCachedItems}" />
  </bean>

  <bean id="decorating.includeComponent.httpIncludeCache.loader"
        class="org.vortikal.web.decorating.components.URLToStringLoader">
    <property name="connectTimeoutSeconds" value="${decorating.includeComponent.connectTimeoutSeconds}" />
    <property name="readTimeoutSeconds" value="${decorating.includeComponent.readTimeoutSeconds}" />
    <property name="clientIdentifier" value="${decorating.includeComponent.identifier}" />
  </bean>

</beans>
