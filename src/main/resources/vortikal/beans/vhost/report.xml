<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
"http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

  <bean id="reportService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="categories">
      <set>
        <value>tabMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="tabOrder">
          <value type="java.lang.Integer">300</value>
        </entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <ref bean="reports.viewPermissionAssertion" />
        <ref bean="resourceInCollection" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="mode" />
          <property name="parameterValue" value="report" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="reportHandler" />
  </bean>

  <bean id="reports.viewPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" ref="ACTION_ALL" />
    <property name="considerLocks" value="false" />
  </bean>


  <bean id="reportHandler" class="org.vortikal.web.actions.report.ReportHandler" parent="repositoryAware">
    <property name="viewName" value="report" />
  </bean>

  <bean id="reporter" abstract="true" class="org.vortikal.web.actions.report.AbstractReporter" parent="repositoryAware">
    <property name="searcher" ref="systemIndexSearcher" />
  </bean>

  <bean id="collectionStructureReporter" class="org.vortikal.web.actions.report.CollectionStructureReporter"
    parent="reporter">
    <property name="name" value="collection-structure" />
    <property name="viewName" value="collectionStructure" />
  </bean>

  <bean id="documentReporter" abstract="true" class="org.vortikal.web.actions.report.DocumentReporter" parent="reporter">
    <property name="viewService" ref="viewService" />
    <property name="viewName" value="documentReport" />
  </bean>

  <bean id="lastModifiedReporter" class="org.vortikal.web.actions.report.LastModifiedReporter" parent="documentReporter">
    <property name="name" value="last-modified" />
    <property name="sortPropDef" ref="lastModifiedPropDef" />
    <property name="titlePropDef" ref="titlePropDef" />
    <property name="sortOrder" ref="SORT_ORDER.DESC" />
  </bean>

  <bean id="myDocumentsReporter" class="org.vortikal.web.actions.report.MyDocumentsReporter" parent="documentReporter">
    <property name="name" value="my-documents" />
    <property name="createdByPropDef" ref="createdByPropDef" />
    <property name="sortPropDef" ref="creationTimePropDef" />
    <property name="sortOrder" ref="SORT_ORDER.DESC" />
  </bean>

  <bean id="diagramReport" class="org.vortikal.web.actions.report.DiagramReport">
    <property name="name" value="diagram" />
    <property name="viewName" value="diagramReport" />
    <property name="filesSearch" ref="diagramFilesReporter.searchComponent" />
    <property name="folderSearch" ref="diagramFolderReporter.searchComponent" />
    <property name="webpageSearch" ref="diagramWebpageReporter.searchComponent" />
    <property name="imageSearch" ref="diagramImageReporter.searchComponent" />
    <property name="audioSearch" ref="diagramAudioReporter.searchComponent" />
    <property name="videoSearch" ref="diagramVideoReporter.searchComponent" />
    <property name="pdfSearch" ref="diagramPdfReporter.searchComponent" />
    <property name="wordSearch" ref="diagramWordReporter.searchComponent" />
    <property name="pptSearch" ref="diagramPptReporter.searchComponent" />
    <property name="excelSearch" ref="diagramExcelReporter.searchComponent" />
  </bean>

  <bean id="report.viewResolver" parent="system.decoratingViewResolver">
    <property name="views">
      <map>
        <entry key="report" value-ref="reportView" />
        <entry key="collectionStructure" value-ref="collectionStructureView" />
        <entry key="documentReport" value-ref="documentReportView" />
        <entry key="diagramReport" value-ref="diagramReportView" />
      </map>
    </property>
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>

  <bean id="reportView" parent="freemarkerView">
    <property name="url" value="pages/report/report.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="cssURLs">
          <list>
            <value>${themeBaseURL}/report/report.css</value>
          </list>
        </entry>
      </map>
    </property>
  </bean>

  <bean id="collectionStructureView" parent="freemarkerView">
    <property name="url" value="pages/report/collection-structure-report.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="cssURLs">
          <list>
            <value>${themeBaseURL}/report/report.css</value>
            <value>${themeBaseURL}/report/jquery.treeview.css</value>
          </list>
        </entry>
        <entry key="jsURLs">
          <list>
            <value>${webResources.baseURL}/jquery/plugins/jquery.vortexTips.js</value>
            <value>${webResources.baseURL}/jquery/plugins/jquery.treeview.js</value>
            <value>${webResources.baseURL}/jquery/plugins/jquery.treeview.async.js</value>
          </list>
        </entry>
      </map>
    </property>
  </bean>

  <bean id="documentReportView" parent="freemarkerView">
    <property name="url" value="pages/report/document-report.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="cssURLs">
          <list>
            <value>${themeBaseURL}/report/report.css</value>
          </list>
        </entry>
      </map>
    </property>
  </bean>

  <bean id="diagramReportView" parent="freemarkerView">
    <property name="url" value="pages/report/diagram-report.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="cssURLs">
          <list>
            <value>${themeBaseURL}/report/report.css</value>
          </list>
        </entry>
      </map>
    </property>
  </bean>

  <bean class="org.springframework.context.support.ResourceBundleMessageSource">
    <property name="basenames">
      <list>
        <value>vortikal.i18n.report.report</value>
      </list>
    </property>
  </bean>

</beans>
