<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
	
	<import resource="namespaces.xml" />
    <import resource="property.xml" />
    <import resource="resource-types/mixins/content-description.xml" />
    <import resource="resource-types/mixins/header-control.xml" />
    <import resource="resource-types/mixins/scientific.xml" />
	
	<bean id="resourceTypeTree" class="org.vortikal.repository.ResourceTypeTreeImpl">
        <property name="typeLocalizationProvider" ref="typeLocalizationProvider" />
        <property name="valueFactory" ref="valueFactory" />
        <property name="valueFormatterRegistry" ref="valueFormatterRegistry" />
    </bean>
    
    <bean id="typeLocalizationProvider"
        class="org.vortikal.repository.resourcetype.MessageSourceTypeLocalizationProvider">
        <property name="messageSource">
            <bean
                class="org.springframework.context.support.ResourceBundleMessageSource">
                <property name="basename" value="vortikal.i18n.resource-types" />
            </bean>
        </property>
    </bean>

    <!-- Resource - base resource type -->
	<bean id="resourceResourceTypeDefinition"
		class="org.vortikal.repository.resourcetype.PrimaryResourceTypeDefinitionImpl">
		<property name="name" value="resource" />
		<property name="namespace" ref="DEFAULT_NAMESPACE" />
		<property name="mixinTypeDefinitions">
		    <list>
		        <ref bean="contentDescriptionMixinResourceTypeDef" />
		        <ref bean="headerControlMixinResourceTypeDef" />
		        <ref bean="scientificDisciplinesMixinResourceTypeDef" />
		    </list>
	    </property>
		<property name="propertyTypeDefinitions">
			<list>
				<ref bean="ownerPropDef" />
				<ref bean="createdByPropDef" />
				<ref bean="collectionPropDef" />
				<ref bean="creationTimePropDef" />
				<ref bean="contentLastModifiedPropDef" />
				<ref bean="contentModifiedByPropDef" />
				<ref bean="propertiesLastModifiedPropDef" />
				<ref bean="propertiesModifiedByPropDef" />
				<ref bean="lastModifiedPropDef" />
				<ref bean="modifiedByPropDef" />
				<ref bean="userTitlePropDef" />
				<ref bean="titlePropDef" />
				<ref bean="contentLocalePropDef" />
				<ref bean="numberOfCommentsPropDef" />
			</list>
		</property>
	</bean>
	
	<bean id="numberOfCommentsPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="numberOfComments" />
		<property name="type" value="INT" />
		<property name="propertiesModificationEvaluator" ref="numberOfCommentsModifiedEvaluator" />
	</bean>
	
	<bean id="numberOfCommentsModifiedEvaluator"
		class="org.vortikal.repository.resourcetype.property.NumberOfCommentsModifiedEvaluator" />
	
	<bean id="titlePropDef"
		class="org.vortikal.repository.resourcetype.OverridablePropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="title" />
		<property name="type" value="HTML" />
		<property name="mandatory" value="true" />
		<property name="createEvaluator" ref="titleEvaluator" />
		<property name="contentModificationEvaluator" ref="titleEvaluator" />
		<property name="nameModificationEvaluator" ref="titleEvaluator" />
	</bean>
	
	<bean id="titleEvaluator"
		class="org.vortikal.repository.resourcetype.property.DefaultTitleEvaluator">
		<property name="propertyDefinition" ref="userTitlePropDef" />
	</bean>
	
	<bean id="userTitlePropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="contentRelation" value="PRE_CONTENT" />
		<property name="name" value="userTitle" />
		<property name="type" value="HTML" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_ACL_WRITE" />
		<property name="valueFormatter" ref="htmlFormatter" />
	</bean>
	
	<bean id="createdByPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="createdBy" />
		<property name="type" value="PRINCIPAL" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
		<property name="mandatory" value="true" />
        <property name="createEvaluator" ref="ownerEvaluator" />
	</bean>
	
	<bean id="ownerPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="owner" />
		<property name="type" value="PRINCIPAL" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_ACL_ADMIN" />
		<property name="mandatory" value="true" />
		<property name="createEvaluator" ref="ownerEvaluator" />
		<property name="validator" ref="ownerEvaluator" />
	</bean>
	
	<bean id="ownerEvaluator" class="org.vortikal.repository.resourcetype.property.OwnerEvaluator">
		<property name="principalManager" ref="principalManager" />
		<property name="authorizationManager" ref="authorizationManager" />
    </bean>
	
	<bean id="collectionPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="collection" />
		<property name="type" value="BOOLEAN" />
		<property name="mandatory" value="true" />
		<property name="createEvaluator" ref="collectionEvaluator" />
	</bean>
	
	<bean id="collectionEvaluator"
		class="org.vortikal.repository.resourcetype.property.CollectionEvaluator" />
	
	<bean id="creationTimePropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="creationTime" />
		<property name="type" value="TIMESTAMP" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
		<property name="mandatory" value="true" />
		<property name="createEvaluator" ref="creationTimeEvaluator" />
	</bean>
	
	<bean id="creationTimeEvaluator"
		class="org.vortikal.repository.resourcetype.property.CreationTimeEvaluator" />
	
	<bean id="contentLastModifiedPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="contentLastModified" />
		<property name="type" value="TIMESTAMP" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
		<property name="mandatory" value="true" />
		<property name="createEvaluator" ref="contentLastModifiedEvaluator" />
		<property name="contentModificationEvaluator" ref="contentLastModifiedEvaluator" />
	</bean>
	
	<bean id="contentLastModifiedEvaluator"
		class="org.vortikal.repository.resourcetype.property.ContentLastModifiedEvaluator" />
	
	<bean id="contentModifiedByPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="contentModifiedBy" />
		<property name="type" value="PRINCIPAL" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
		<property name="mandatory" value="true" />
		<property name="createEvaluator" ref="contentModifiedByEvaluator" />
		<property name="contentModificationEvaluator" ref="contentModifiedByEvaluator" />
	</bean>
	
	<bean id="contentModifiedByEvaluator"
		class="org.vortikal.repository.resourcetype.property.ContentModifiedByEvaluator" />
	
	<bean id="propertiesLastModifiedPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="propertiesLastModified" />
		<property name="type" value="TIMESTAMP" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
		<property name="mandatory" value="true" />
		<property name="createEvaluator" ref="propertiesLastModifiedEvaluator" />
		<property name="propertiesModificationEvaluator" ref="propertiesLastModifiedEvaluator" />
	</bean>
	
	<bean id="propertiesLastModifiedEvaluator"
		class="org.vortikal.repository.resourcetype.property.PropertiesLastModifiedEvaluator" />
	
	<bean id="propertiesModifiedByPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="propertiesModifiedBy" />
		<property name="type" value="PRINCIPAL" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_ROLE_ADMIN" />
		<property name="mandatory" value="true" />
		<property name="createEvaluator" ref="propertiesModifiedByEvaluator" />
		<property name="propertiesModificationEvaluator" ref="propertiesModifiedByEvaluator" />
	</bean>
	
	<bean id="propertiesModifiedByEvaluator"
		class="org.vortikal.repository.resourcetype.property.PropertiesModifiedByEvaluator" />
	
	<bean id="lastModifiedPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="lastModified" />
		<property name="type" value="TIMESTAMP" />
		<property name="mandatory" value="true" />
		<property name="createEvaluator" ref="lastModifiedEvaluator" />
		<property name="propertiesModificationEvaluator" ref="lastModifiedEvaluator" />
		<property name="contentModificationEvaluator" ref="lastModifiedEvaluator" />
	</bean>
	
	<bean id="lastModifiedEvaluator"
		class="org.vortikal.repository.resourcetype.property.LastModifiedEvaluator" />
	
	<bean id="modifiedByPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="modifiedBy" />
		<property name="type" value="PRINCIPAL" />
		<property name="mandatory" value="true" />
		<property name="createEvaluator" ref="lastModifiedByEvaluator" />
		<property name="contentModificationEvaluator" ref="lastModifiedByEvaluator" />
		<property name="propertiesModificationEvaluator" ref="lastModifiedByEvaluator" />
	</bean>
	
	<bean id="lastModifiedByEvaluator"
		class="org.vortikal.repository.resourcetype.property.LastModifiedByEvaluator" />
	
	<bean id="contentLocalePropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="contentLocale" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_ACL_WRITE" />
        <!-- should have a constraint -->
		<property name="vocabulary">
			<bean class="org.vortikal.repository.resourcetype.ValueVocabulary">
				<property name="messageSourceBaseName"
					value="vortikal.beans.vhost.backend.resource.resource-types.properties.content-locale" />
				<property name="values">
					<list>
						<bean class="org.vortikal.repository.resourcetype.Value">
							<constructor-arg type="java.lang.String">
								<value>no_NO</value>
							</constructor-arg>
						</bean>
						<bean class="org.vortikal.repository.resourcetype.Value">
							<constructor-arg type="java.lang.String">
								<value>no_NO_NY</value>
							</constructor-arg>
						</bean>
						<bean class="org.vortikal.repository.resourcetype.Value">
							<constructor-arg type="java.lang.String">
								<value>en</value>
							</constructor-arg>
						</bean>
					</list>
				</property>
			</bean>
		</property>
	</bean>
	
</beans>