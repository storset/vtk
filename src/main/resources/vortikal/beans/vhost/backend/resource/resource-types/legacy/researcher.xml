<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

	<import resource="../managed-xml.xml" />

    <!-- Researcher XML resource -->
	<bean id="researcherXmlResource"
		class="org.vortikal.repository.resourcetype.PrimaryResourceTypeDefinitionImpl">
		<property name="name" value="researcher" />
		<property name="namespace" ref="DEFAULT_NAMESPACE" />
		<property name="parentTypeDefinition" ref="managedXmlResource" />
		<property name="propertyTypeDefinitions">
			<list>
				<ref bean="researcherIdPropDef" />
				<ref bean="researcherGivenNamePropDef" />
				<ref bean="researcherSurNamePropDef" />
				<ref bean="researcherImagePropDef" />
				<ref bean="researcherSubjectsPropDef" />
				<ref bean="positionTitlePropDef" />
			</list>
		</property>
		<property name="assertions">
			<list>
				<ref bean="schemaIsResearcher" />
			</list>
		</property>
	</bean>
	
	<bean id="schemaIsResearcher"
		class="org.vortikal.web.service.ResourcePropertyRegexpAssertion">
		<property name="namespace" ref="DEFAULT_NAMESPACE" />
		<property name="name" value="schema" />
		<property name="pattern"
			value="http://www.uio.no/xsd/forskning/forsker/v00.*" />
	</bean>
	
	<bean id="researcherIdPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="researcherId" />
		<property name="type" value="STRING" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
		<property name="mandatory" value="true" />
		<property name="contentModificationEvaluator" ref="researcherIdEvaluator" />
	</bean>
	
	<bean id="researcherIdEvaluator" parent="abstractXPathEvaluator">
		<property name="expression" value="/researcher/@id" />
	</bean>
	
	<bean id="researcherGivenNamePropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="researcherGivenName" />
		<property name="type" value="STRING" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
		<property name="mandatory" value="false" />
		<property name="contentModificationEvaluator" ref="researcherGivenNameEvaluator" />
	</bean>
	
	<bean id="researcherGivenNameEvaluator" parent="abstractXPathEvaluator">
		<property name="expression" value="/researcher/givenName" />
	</bean>
	
	<bean id="researcherSurNamePropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="researcherSurName" />
		<property name="type" value="STRING" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
		<property name="mandatory" value="false" />
		<property name="contentModificationEvaluator" ref="researcherSurNameEvaluator" />
	</bean>
	
	<bean id="researcherSurNameEvaluator" parent="abstractXPathEvaluator">
		<property name="expression" value="/researcher/surName" />
	</bean>
	
	<bean id="researcherImagePropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="researcherImage" />
		<property name="type" value="STRING" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
		<property name="mandatory" value="false" />
		<property name="contentModificationEvaluator" ref="researcherImageEvaluator" />
	</bean>
	
	<bean id="researcherImageEvaluator" parent="abstractXPathEvaluator">
		<property name="expression" value="/researcher/image/@href" />
	</bean>
	
	<bean id="researcherSubjectsPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="researcherSubjects" />
		<property name="type" value="STRING" />
		<property name="multiple" value="true" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
		<property name="mandatory" value="false" />
		<property name="contentModificationEvaluator" ref="researchSubjectsEvaluator" />
	</bean>
	
	<bean id="researchSubjectsEvaluator" parent="abstractXPathEvaluator">
		<property name="expression" value="/subjects/subject" />
	</bean>
	
	<bean id="positionTitlePropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="positionTitle" />
		<property name="type" value="STRING" />
		<property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
		<property name="mandatory" value="false" />
		<property name="contentModificationEvaluator" ref="positionTitleEvaluator" />
	</bean>
	
	<bean id="positionTitleEvaluator" parent="abstractXPathEvaluator">
		<property name="expression" value="/researcher/title/name" />
	</bean>
	
</beans>