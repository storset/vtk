<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

	<import resource="text.xml" />
  
    <!-- XML resource -->
	<bean id="xmlResource"
		class="org.vortikal.repository.resourcetype.PrimaryResourceTypeDefinitionImpl">
		<property name="name" value="xml-resource" />
		<property name="namespace" ref="DEFAULT_NAMESPACE" />
		<property name="parentTypeDefinition" ref="textResourceTypeDefinition" />
		<property name="assertions">
			<list>
				<ref bean="contentTypeMatchesXml" />
			</list>
		</property>
		<property name="propertyTypeDefinitions">
			<list>
				<ref bean="schemaPropDef" />
				<ref bean="xmlOverriddenGuessedCharacterEncodingPropDef" />
				<ref bean="xmlOverriddenCharacterEncodingPropDef" />
			</list>
		</property>
	</bean>
	
	<bean id="schemaPropDef"
		class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="schema" />
		<property name="contentModificationEvaluator" ref="schemaEvaluator" />
	</bean>
	
	<bean id="abstractXPathEvaluator"
		class="org.vortikal.repository.resourcetype.property.XPathEvaluator"
		abstract="true">
		<property name="customFunctions">
			<set>
				<ref bean="xpathLocalizerFunction" />
			</set>
		</property>
		<property name="valueFactory" ref="valueFactory" />
	</bean>

	<bean id="xpathLocalizerFunction"
		class="org.vortikal.repository.resourcetype.property.MessageLocalizerXPathFunction">
		<property name="namespace" value="vrtx" />
		<property name="prefix" value="vrtx" />
		<property name="name" value="localize" />
		<property name="messageSource" ref="messageSource" />
		<property name="defaultLocale" value="${view.defaultLocale}" />
		<property name="localePropertyDefinition" ref="contentLocalePropDef" />
	</bean>
	
	<bean id="schemaEvaluator"
		class="org.vortikal.repository.resourcetype.property.XMLSchemaEvaluator" />
	
	<bean id="xmlOverriddenGuessedCharacterEncodingPropDef"
		class="org.vortikal.repository.resourcetype.OverridingPropertyTypeDefinitionImpl">
		<property name="overriddenPropDef" ref="guessedCharacterEncodingPropDef" />
		<property name="contentModificationEvaluator" ref="xmlGuessedCharacterEncodingEvaluator" />
		<property name="defaultValue">
			<bean class="org.vortikal.repository.resourcetype.Value">
				<constructor-arg type="java.lang.String"
					value="${defaultXmllResourceCharacterEncoding}" />
			</bean>
		</property>
	</bean>
	
	<bean id="xmlGuessedCharacterEncodingEvaluator"
		class="org.vortikal.repository.resourcetype.property.XMLCharacterEncodingEvaluator" />
	
	<bean id="xmlOverriddenCharacterEncodingPropDef"
		class="org.vortikal.repository.resourcetype.OverridingPropertyTypeDefinitionImpl">
		<property name="overriddenPropDef" ref="characterEncodingPropDef" />
	</bean>
	
</beans>